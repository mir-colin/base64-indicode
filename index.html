<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Base64 ì¸ì½”ë”/ë””ì½”ë”</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
      font-size: 32px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid #e0e0e0;
    }

    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      color: #666;
      transition: all 0.3s;
    }

    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }

    .tab:hover {
      color: #667eea;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .section {
      margin-bottom: 25px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 600;
      font-size: 14px;
    }

    textarea {
      width: 100%;
      min-height: 150px;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      font-family: 'Courier New', monospace;
      resize: vertical;
      transition: border-color 0.3s;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .file-upload {
      border: 3px dashed #e0e0e0;
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #f8f9fa;
    }

    .file-upload:hover {
      border-color: #667eea;
      background: #f0f4ff;
    }

    .file-upload.dragover {
      border-color: #667eea;
      background: #e8edff;
    }

    .file-upload input {
      display: none;
    }

    .file-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .file-text {
      color: #666;
      font-size: 14px;
    }

    .limit-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .limit-btn {
      padding: 8px 16px;
      background: #f0f0f0;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s;
    }

    .limit-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .limit-btn:hover {
      border-color: #667eea;
    }

    .info-box {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .info-row:last-child {
      margin-bottom: 0;
    }

    .info-label {
      color: #666;
      font-weight: 600;
    }

    .info-value {
      color: #333;
      font-family: 'Courier New', monospace;
    }

    .warning {
      color: #f5576c;
      font-weight: 600;
    }

    .success {
      color: #4caf50;
      font-weight: 600;
    }

    .preview-box {
      background: #f8f9fa;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-box img {
      max-width: 100%;
      max-height: 400px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .preview-empty {
      color: #999;
      font-size: 14px;
    }

    button {
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    button.secondary:hover {
      box-shadow: 0 8px 16px rgba(245, 87, 108, 0.3);
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: #e0e0e0;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s;
    }

    .alert-box {
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      display: none;
    }

    .alert-box.show {
      display: block;
    }

    .alert-box.error {
      background: #f8d7da;
      border-color: #f5576c;
    }

    .alert-box.success {
      background: #d4edda;
      border-color: #4caf50;
    }

    .alert-title {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .alert-message {
      font-size: 13px;
      color: #666;
    }

    .quality-slider {
      width: 100%;
      margin-top: 10px;
    }

    .compression-info {
      margin-top: 10px;
      padding: 10px;
      background: #f0f4ff;
      border-radius: 5px;
      font-size: 12px;
      color: #667eea;
    }

    @media (max-width: 768px) {
      .container {
        padding: 25px;
      }

      h1 {
        font-size: 24px;
      }

      .tabs {
        flex-direction: column;
      }

      .tab {
        text-align: left;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”„ Base64 ì¸ì½”ë”/ë””ì½”ë”</h1>
    <p class="subtitle">í…ìŠ¤íŠ¸ì™€ ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ë³€í™˜í•˜ê±°ë‚˜ ë””ì½”ë”©í•˜ì„¸ìš”</p>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('text-encode')">í…ìŠ¤íŠ¸ â†’ Base64</button>
      <button class="tab" onclick="switchTab('text-decode')">Base64 â†’ í…ìŠ¤íŠ¸</button>
      <button class="tab" onclick="switchTab('image-encode')">ì´ë¯¸ì§€ â†’ Base64</button>
      <button class="tab" onclick="switchTab('image-decode')">Base64 â†’ ì´ë¯¸ì§€</button>
    </div>

    <!-- í…ìŠ¤íŠ¸ ì¸ì½”ë”© -->
    <div id="text-encode" class="tab-content active">
      <div class="section">
        <label>í…ìŠ¤íŠ¸ ì…ë ¥</label>
        <textarea id="text-input" placeholder="ë³€í™˜í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      </div>

      <div class="section">
        <label>ìš©ëŸ‰ ì œí•œ ì„¤ì •</label>
        <div class="limit-selector">
          <button class="limit-btn active" data-limit="50000">5ë§Œì</button>
          <button class="limit-btn" data-limit="100000">10ë§Œì</button>
          <button class="limit-btn" data-limit="200000">20ë§Œì</button>
          <button class="limit-btn" data-limit="-1">ì œí•œ ì—†ìŒ</button>
        </div>
      </div>

      <div class="info-box" id="text-encode-info">
        <div class="info-row">
          <span class="info-label">ì…ë ¥ ê¸¸ì´:</span>
          <span class="info-value">0ì</span>
        </div>
        <div class="info-row">
          <span class="info-label">ì˜ˆìƒ Base64 ê¸¸ì´:</span>
          <span class="info-value">0ì</span>
        </div>
        <div class="info-row">
          <span class="info-label">ìƒíƒœ:</span>
          <span class="info-value success">âœ“ ë³€í™˜ ê°€ëŠ¥</span>
        </div>
      </div>

      <div class="button-group">
        <button onclick="encodeText()">Base64ë¡œ ë³€í™˜</button>
        <button class="secondary" onclick="copyToClipboard('text-output')">ê²°ê³¼ ë³µì‚¬</button>
        <button class="secondary" onclick="clearText('text-input')">ì´ˆê¸°í™”</button>
      </div>

      <div class="section">
        <label>Base64 ê²°ê³¼</label>
        <textarea id="text-output" readonly placeholder="ë³€í™˜ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
      </div>
    </div>

    <!-- í…ìŠ¤íŠ¸ ë””ì½”ë”© -->
    <div id="text-decode" class="tab-content">
      <div class="section">
        <label>Base64 ì…ë ¥</label>
        <textarea id="base64-input" placeholder="ë””ì½”ë”©í•  Base64 ë¬¸ìì—´ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      </div>

      <div class="button-group">
        <button onclick="decodeText()">í…ìŠ¤íŠ¸ë¡œ ë³€í™˜</button>
        <button class="secondary" onclick="copyToClipboard('decoded-output')">ê²°ê³¼ ë³µì‚¬</button>
        <button class="secondary" onclick="clearText('base64-input')">ì´ˆê¸°í™”</button>
      </div>

      <div class="section">
        <label>ë””ì½”ë”© ê²°ê³¼</label>
        <textarea id="decoded-output" readonly placeholder="ë””ì½”ë”© ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
      </div>
    </div>

    <!-- ì´ë¯¸ì§€ ì¸ì½”ë”© -->
    <div id="image-encode" class="tab-content">
      <div class="section">
        <label>ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
        <div class="file-upload" id="file-drop-zone" onclick="document.getElementById('file-input').click()">
          <input type="file" id="file-input" accept="image/*" onchange="handleFileSelect(event)">
          <div class="file-icon">ğŸ“</div>
          <div class="file-text">í´ë¦­í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
          <div class="file-text" style="margin-top: 5px; font-size: 12px; color: #999;">JPG, PNG, GIF, WebP ì§€ì›</div>
        </div>
      </div>

      <div class="section">
        <label>ìš©ëŸ‰ ì œí•œ ì„¤ì • (Base64 ê¸¸ì´ ê¸°ì¤€)</label>
        <div class="limit-selector" id="image-limit-selector">
          <button class="limit-btn" data-limit="50000">5ë§Œì (~37KB)</button>
          <button class="limit-btn active" data-limit="100000">10ë§Œì (~75KB)</button>
          <button class="limit-btn" data-limit="200000">20ë§Œì (~150KB)</button>
          <button class="limit-btn" data-limit="500000">50ë§Œì (~375KB)</button>
          <button class="limit-btn" data-limit="-1">ì œí•œ ì—†ìŒ</button>
        </div>
      </div>

      <div id="compress-alert" class="alert-box">
        <div class="alert-title">âš ï¸ ìš©ëŸ‰ ì´ˆê³¼ - ìë™ ì••ì¶• ì¤‘</div>
        <div class="alert-message">ì´ë¯¸ì§€ê°€ ì„¤ì •ëœ ìš©ëŸ‰ì„ ì´ˆê³¼í•˜ì—¬ ìë™ìœ¼ë¡œ ì••ì¶•ë©ë‹ˆë‹¤.</div>
        <div class="compression-info" id="compression-info"></div>
      </div>

      <div class="info-box" id="image-encode-info" style="display: none;">
        <div class="info-row">
          <span class="info-label">íŒŒì¼ëª…:</span>
          <span class="info-value" id="file-name">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">ì›ë³¸ í¬ê¸°:</span>
          <span class="info-value" id="original-size">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">ì••ì¶• í›„ í¬ê¸°:</span>
          <span class="info-value" id="compressed-size">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Base64 ê¸¸ì´:</span>
          <span class="info-value" id="base64-length">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">ìš©ëŸ‰ ì œí•œ:</span>
          <span class="info-value" id="limit-display">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">ìƒíƒœ:</span>
          <span class="info-value" id="encode-status">-</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
      </div>

      <div class="section">
        <label>ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</label>
        <div class="preview-box" id="image-preview">
          <div class="preview-empty">ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
        </div>
      </div>

      <div class="button-group">
        <button class="secondary" onclick="copyToClipboard('image-base64-output')">Base64 ë³µì‚¬</button>
        <button class="secondary" onclick="downloadBase64()">Base64 ë‹¤ìš´ë¡œë“œ</button>
        <button class="secondary" onclick="clearImage()">ì´ˆê¸°í™”</button>
      </div>

      <div class="section">
        <label>Base64 ê²°ê³¼</label>
        <textarea id="image-base64-output" readonly placeholder="ë³€í™˜ëœ Base64 ë¬¸ìì—´ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
      </div>
    </div>

    <!-- ì´ë¯¸ì§€ ë””ì½”ë”© -->
    <div id="image-decode" class="tab-content">
      <div class="section">
        <label>Base64 ë¬¸ìì—´ ì…ë ¥</label>
        <textarea id="base64-to-image-input" placeholder="data:image/png;base64,iVBORw0KG... í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”"></textarea>
      </div>

      <div class="button-group">
        <button onclick="decodeImage()">ì´ë¯¸ì§€ë¡œ ë³€í™˜</button>
        <button class="secondary" onclick="downloadDecodedImage()">ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</button>
        <button class="secondary" onclick="clearText('base64-to-image-input')">ì´ˆê¸°í™”</button>
      </div>

      <div class="section">
        <label>ë³€í™˜ëœ ì´ë¯¸ì§€</label>
        <div class="preview-box" id="decoded-image-preview">
          <div class="preview-empty">Base64ë¥¼ ì…ë ¥í•˜ê³  ë³€í™˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentLimit = 100000;
    let currentBase64 = '';
    let currentImageData = null;
    let currentFile = null;

    // íƒ­ ì „í™˜
    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    // ìš©ëŸ‰ ì œí•œ ë²„íŠ¼ (í…ìŠ¤íŠ¸)
    document.querySelectorAll('#text-encode .limit-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        this.parentElement.querySelectorAll('.limit-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        // í…ìŠ¤íŠ¸ ì…ë ¥ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
        document.getElementById('text-input').dispatchEvent(new Event('input'));
      });
    });

    // ìš©ëŸ‰ ì œí•œ ë²„íŠ¼ (ì´ë¯¸ì§€)
    document.querySelectorAll('#image-limit-selector .limit-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        this.parentElement.querySelectorAll('.limit-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentLimit = parseInt(this.dataset.limit);
        
        // ì´ë¯¸ íŒŒì¼ì´ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ ë‹¤ì‹œ ì²˜ë¦¬
        if (currentFile) {
          processFile(currentFile);
        }
      });
    });

    // í…ìŠ¤íŠ¸ ì…ë ¥ ëª¨ë‹ˆí„°ë§
    document.getElementById('text-input').addEventListener('input', function() {
      const text = this.value;
      const inputLength = text.length;
      const base64Length = Math.ceil(inputLength * 4 / 3);
      
      const textLimitBtns = document.querySelectorAll('#text-encode .limit-btn');
      let textLimit = -1;
      textLimitBtns.forEach(btn => {
        if (btn.classList.contains('active')) {
          textLimit = parseInt(btn.dataset.limit);
        }
      });
      
      const infoBox = document.getElementById('text-encode-info');
      const rows = infoBox.querySelectorAll('.info-row');
      
      rows[0].querySelector('.info-value').textContent = inputLength.toLocaleString() + 'ì';
      rows[1].querySelector('.info-value').textContent = base64Length.toLocaleString() + 'ì';
      
      if (textLimit > 0 && base64Length > textLimit) {
        rows[2].querySelector('.info-value').innerHTML = '<span class="warning">âœ— ìš©ëŸ‰ ì œí•œ ì´ˆê³¼</span>';
      } else {
        rows[2].querySelector('.info-value').innerHTML = '<span class="success">âœ“ ë³€í™˜ ê°€ëŠ¥</span>';
      }
    });

    // í…ìŠ¤íŠ¸ ì¸ì½”ë”©
    function encodeText() {
      const text = document.getElementById('text-input').value;
      if (!text) {
        alert('í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
      }

      const base64 = btoa(unescape(encodeURIComponent(text)));
      
      const textLimitBtns = document.querySelectorAll('#text-encode .limit-btn');
      let textLimit = -1;
      textLimitBtns.forEach(btn => {
        if (btn.classList.contains('active')) {
          textLimit = parseInt(btn.dataset.limit);
        }
      });
      
      if (textLimit > 0 && base64.length > textLimit) {
        alert(`Base64 ê¸¸ì´ê°€ ${textLimit.toLocaleString()}ìë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤!\ní˜„ì¬: ${base64.length.toLocaleString()}ì\n\ní…ìŠ¤íŠ¸ë¥¼ ì¤„ì´ê±°ë‚˜ ìš©ëŸ‰ ì œí•œì„ ëŠ˜ë ¤ì£¼ì„¸ìš”.`);
        return;
      }

      document.getElementById('text-output').value = base64;
    }

    // í…ìŠ¤íŠ¸ ë””ì½”ë”©
    function decodeText() {
      const base64 = document.getElementById('base64-input').value;
      if (!base64) {
        alert('Base64 ë¬¸ìì—´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
      }

      try {
        const text = decodeURIComponent(escape(atob(base64)));
        document.getElementById('decoded-output').value = text;
      } catch (e) {
        alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ Base64 í˜•ì‹ì…ë‹ˆë‹¤!');
      }
    }

    // íŒŒì¼ ì„ íƒ
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        currentFile = file;
        processFile(file);
      }
    }

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­
    const dropZone = document.getElementById('file-drop-zone');
    
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        currentFile = file;
        processFile(file);
      } else {
        alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤!');
      }
    });

    // íŒŒì¼ ì²˜ë¦¬ (ê°œì„ ëœ ì••ì¶• ë¡œì§)
    function processFile(file) {
      const reader = new FileReader();
      
      reader.onloadstart = () => {
        document.getElementById('progress-fill').style.width = '0%';
      };

      reader.onprogress = (e) => {
        if (e.lengthComputable) {
          const percent = (e.loaded / e.total) * 30;
          document.getElementById('progress-fill').style.width = percent + '%';
        }
      };

      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          document.getElementById('progress-fill').style.width = '50%';
          compressImageAdvanced(img, file);
        };
        img.src = e.target.result;
      };

      reader.readAsDataURL(file);
    }

    // ê°œì„ ëœ ì´ë¯¸ì§€ ì••ì¶• ì•Œê³ ë¦¬ì¦˜
    function compressImageAdvanced(img, file) {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      let width = img.width;
      let height = img.height;
      let base64 = '';
      let compressionSteps = [];
      
      const alertBox = document.getElementById('compress-alert');
      const compressionInfo = document.getElementById('compression-info');
      
      // ìš©ëŸ‰ ì œí•œì´ ì—†ëŠ” ê²½ìš°
      if (currentLimit <= 0) {
        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(img, 0, 0, width, height);
        base64 = canvas.toDataURL('image/jpeg', 0.92);
        alertBox.classList.remove('show');
      } else {
        // 1ë‹¨ê³„: ì´ˆê¸° í¬ê¸° ì¡°ì • (Base64 ê¸¸ì´ ê¸°ì¤€ìœ¼ë¡œ ì˜ˆì¸¡)
        const estimatedBase64Length = (file.size * 4 / 3) * 1.4; // ì—¬ìœ ìˆê²Œ ì˜ˆì¸¡
        
        if (estimatedBase64Length > currentLimit) {
          // í¬ê¸°ë¥¼ ë¨¼ì € ì¤„ì„
          const sizeRatio = Math.sqrt(currentLimit / estimatedBase64Length) * 0.9;
          width = Math.floor(img.width * sizeRatio);
          height = Math.floor(img.height * sizeRatio);
          compressionSteps.push(`í¬ê¸° ì¡°ì •: ${img.width}x${img.height} â†’ ${width}x${height}`);
        }
        
        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(img, 0, 0, width, height);
        
        // 2ë‹¨ê³„: í’ˆì§ˆ ì¡°ì •ìœ¼ë¡œ ë¯¸ì„¸ ì¡°ì •
        let quality = 0.92;
        base64 = canvas.toDataURL('image/jpeg', quality);
        let attempts = 0;
        const maxAttempts = 15;
        
        while (base64.length > currentLimit && attempts < maxAttempts) {
          if (base64.length > currentLimit * 1.5) {
            // ìš©ëŸ‰ì´ ë§ì´ ì´ˆê³¼í•˜ë©´ í¬ê¸°ë¥¼ ë” ì¤„ì„
            width = Math.floor(width * 0.9);
            height = Math.floor(height * 0.9);
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            quality = 0.85;
            compressionSteps.push(`ì¶”ê°€ í¬ê¸° ì¡°ì •: ${width}x${height}`);
          } else {
            // ìš©ëŸ‰ì´ ì¡°ê¸ˆ ì´ˆê³¼í•˜ë©´ í’ˆì§ˆë§Œ ì¡°ì •
            quality -= 0.05;
          }
          
          base64 = canvas.toDataURL('image/jpeg', quality);
          attempts++;
        }
        
        compressionSteps.push(`ìµœì¢… í’ˆì§ˆ: ${Math.round(quality * 100)}%`);
        compressionSteps.push(`ì••ì¶• ì‹œë„: ${attempts}íšŒ`);
        
        // ì••ì¶• ì •ë³´ í‘œì‹œ
        if (base64.length > currentLimit * 0.8) {
          alertBox.classList.add('show');
          compressionInfo.innerHTML = compressionSteps.join('<br>');
        } else {
          alertBox.classList.remove('show');
        }
      }
      
      currentBase64 = base64;
      currentImageData = base64;
      
      // ì •ë³´ ì—…ë°ì´íŠ¸
      const infoBox = document.getElementById('image-encode-info');
      infoBox.style.display = 'block';
      
      document.getElementById('file-name').textContent = file.name;
      document.getElementById('original-size').textContent = formatFileSize(file.size);
      
      // Base64ì—ì„œ ì‹¤ì œ ì´ë¯¸ì§€ í¬ê¸° ê³„ì‚°
      const base64Size = Math.floor((base64.length - base64.indexOf(',') - 1) * 3 / 4);
      document.getElementById('compressed-size').textContent = formatFileSize(base64Size);
      document.getElementById('base64-length').textContent = base64.length.toLocaleString() + 'ì';
      
      const limitText = currentLimit > 0 ? currentLimit.toLocaleString() + 'ì' : 'ì œí•œ ì—†ìŒ';
      document.getElementById('limit-display').textContent = limitText;
      
      const statusEl = document.getElementById('encode-status');
      const percentage = currentLimit > 0 ? Math.round((base64.length / currentLimit) * 100) : 0;
      
      if (currentLimit > 0 && base64.length > currentLimit) {
        statusEl.innerHTML = '<span class="warning">âœ— ì••ì¶• ì‹¤íŒ¨ (' + percentage + '%) - ìš©ëŸ‰ ì œí•œì„ ëŠ˜ë ¤ì£¼ì„¸ìš”</span>';
        alertBox.classList.add('show');
        alertBox.classList.add('error');
      } else if (currentLimit > 0 && base64.length > currentLimit * 0.9) {
        statusEl.innerHTML = '<span class="warning">âš  ìš©ëŸ‰ ê·¼ì ‘ (' + percentage + '%)</span>';
      } else {
        statusEl.innerHTML = '<span class="success">âœ“ ë³€í™˜ ì™„ë£Œ' + (currentLimit > 0 ? ' (' + percentage + '%)' : '') + '</span>';
        alertBox.classList.remove('error');
      }
      
      document.getElementById('progress-fill').style.width = '100%';
      
      // ë¯¸ë¦¬ë³´ê¸°
      document.getElementById('image-preview').innerHTML = 
        '<img src="' + base64 + '" alt="Preview">';
      
      // Base64 ì¶œë ¥
      document.getElementById('image-base64-output').value = base64;
    }

    // íŒŒì¼ í¬ê¸° í¬ë§·
    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
    }

    // ì´ë¯¸ì§€ ë””ì½”ë”©
    function decodeImage() {
      let base64 = document.getElementById('base64-to-image-input').value.trim();
      if (!base64) {
        alert('Base64 ë¬¸ìì—´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
      }

      // data:image í˜•ì‹ì´ ì•„ë‹ˆë©´ ì¶”ê°€
      if (!base64.startsWith('data:image')) {
        base64 = 'data:image/png;base64,' + base64;
      }

      try {
        currentImageData = base64;
        document.getElementById('decoded-image-preview').innerHTML = 
          '<img src="' + base64 + '" alt="Decoded Image">';
      } catch (e) {
        alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ Base64 í˜•ì‹ì…ë‹ˆë‹¤!');
      }
    }

    // í´ë¦½ë³´ë“œ ë³µì‚¬
    function copyToClipboard(elementId) {
      const element = document.getElementById(elementId);
      if (!element.value) {
        alert('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤!');
        return;
      }

      element.select();
      document.execCommand('copy');
      
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'âœ“ ë³µì‚¬ë¨!';
      setTimeout(() => {
        btn.textContent = originalText;
      }, 2000);
    }

    // Base64 ë‹¤ìš´ë¡œë“œ
    function downloadBase64() {
      const base64 = document.getElementById('image-base64-output').value;
      if (!base64) {
        alert('ë‹¤ìš´ë¡œë“œí•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤!');
        return;
      }

      const blob = new Blob([base64], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'base64.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
    function downloadDecodedImage() {
      if (!currentImageData) {
        alert('ë‹¤ìš´ë¡œë“œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!');
        return;
      }

      const a = document.createElement('a');
      a.href = currentImageData;
      a.download = 'decoded-image.png';
      a.click();
    }

    // ì´ˆê¸°í™”
    function clearText(elementId) {
      document.getElementById(elementId).value = '';
      if (elementId === 'text-input') {
        document.getElementById('text-input').dispatchEvent(new Event('input'));
      }
    }

    function clearImage() {
      document.getElementById('file-input').value = '';
      document.getElementById('image-preview').innerHTML = 
        '<div class="preview-empty">ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
      document.getElementById('image-base64-output').value = '';
      document.getElementById('image-encode-info').style.display = 'none';
      document.getElementById('compress-alert').classList.remove('show');
      document.getElementById('compress-alert').classList.remove('error');
      document.getElementById('progress-fill').style.width = '0%';
      currentBase64 = '';
      currentImageData = null;
      currentFile = null;
    }
  </script>
</body>
</html>
